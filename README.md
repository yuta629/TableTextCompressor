# TableTextCompressor
テキスト長体調整

# **InDesignスクリプト「テキスト長体調整」使用マニュアル**

## **1\. 概要**

選択した「表セル」「テキストボックス」「テキスト（段落）」に対し、文字あふれの解消や指定行数への収め込みを目的として、自動で長体（水平比率）を調整するスクリプトです。

## **2\. 基本的な使い方**

1. **対象を選択する**  
   * **表セル:** 調整したいセルを選択（複数可）。  
   * **テキストボックス:** 黒矢印ツール等でフレームを選択（複数可）。  
   * **テキスト:** 文字ツールで調整したい段落範囲を選択。  
2. **スクリプトを実行する**  
   * スクリプトパネルから TableTextCompressor.jsx をダブルクリックします。  
3. **設定して実行**  
   * 表示されるダイアログで条件を設定し、「実行」ボタンを押します。

## **3\. ダイアログの設定項目**

### **■ 対象**

現在選択しているアイテムの種類と数が表示されます。自動判定のため変更はできません。

### **■ 文字あふれ処理**

* **オート：あふれ解消を優先（推奨）**  
  * チェックを入れると、文字あふれ（オーバーフロー）が解消されるまで自動的に長体をかけます。  
  * あふれていない場合は、現状維持、または下記の「目標行数」設定に従います。  
* **チェックを外す（行数指定モード）**  
  * あふれの有無に関わらず、下の「目標行数設定」で指定した行数になるよう調整します。

### **■ 目標行数設定**

* **「〇行以内にする」**  
  * オートOFF時、またはあふれていない場合に、この行数に収まるまで長体をかけます。  
  * *例：「1行」に設定 → 2行になっているテキストを1行に収めます。*

### **■ 段落先頭文字の処理**

* **全ての文字を変形する**  
  * 段落全体に均等に長体をかけます。  
* **段落の先頭文字は変形しない**  
  * 箇条書きの「・」や番号など、先頭の1文字だけ比率を維持（100%または元の比率）し、2文字目以降に長体をかけます。  
  * *注：連結フレームの場合、選択していないフレーム内の段落には適用されません。*

### **■ 【テキストボックス選択時のみ】先頭文字リセットモード**

* **ストーリー全段落の先頭文字を100%にする**  
  * このチェックを入れると、他の設定は無効になります。  
  * **長体調整は行わず**、連結されたストーリー全体の全段落の先頭文字を強制的に「水平比率100%」に戻します。  
  * 連結フレームで先頭文字保護が漏れてしまった場合などの修正に使用します。

## **4\. 重要な仕様と注意点**

### **⚠️ 変形率の制限とキャンセル**

* **最小変形率は 40%** です。  
* 40%まで圧縮しても「あふれが解消しない」または「目標行数に入らない」場合は、**変更を行わず処理前の状態に戻します（スキップ判定）**。

### **⚠️ 連結テキストフレームの扱い**

* テキストボックス選択時、選択したフレームが連結されている場合、**警告ダイアログ**が表示されます。  
* 実行すると、選択していないフレームも含めた**ストーリー全体**が変形対象となります。  
* 行数指定モードの場合、「選択したフレーム内の行数」を基準に判定します。

## **5\. 動作環境**

* Adobe InDesign (macOS / Windows)  
* アンドゥ（取り消し）は Cmd+Z (Ctrl+Z) 1回でスクリプト実行前の状態に戻ります。
